trousers README

  Trousers is an open-source TCG Software Stack (TSS), released under
the Common Public License. Trousers aims to be compliant with the
current (1.1b) and upcoming (1.2) TSS specifications available from
the Trusted Computing Group website:

http://www.trustedcomputinggroup.org


BUILD REQUIREMENTS

  Currently this software is BETA quality and will build, however it
is not fully functional.

  Packages needed to build:

  automake
  autoconf
  pkgconfig
  libtool
  gtk2-devel
  openssl-0.9.7 or newer
  openssl-devel-0.9.7 or newer
  pthreads library (glibc-devel)


BUILDING the TSS

  Build and install the latest TPM device driver from
  sf.net/projects/tpmdd either compiled in or loaded as a
  module. UPDATE: This driver is now included in the vanilla 2.6.12
  kernel!  If you are doing this, trousers should just work after a
  vanilla build. Follow the build instructions below and read
  RUNNING the TSS, below.

  To build trousers after you have the device driver installed:

  $ sh bootstrap.sh
  $ ./configure [--enable-debug] [--enable-prof] [--enable-efence] \
                [--enable-gcov]
  $ make
  $ make install

  Here are the default locations of files that trousers installs:

  /usr/local/sbin/tcsd
  /usr/local/etc/tcsd.conf
  /usr/local/lib/libtspi.so.0.0.X
  /usr/local/lib/libtspi.so.0 -> libtspi.so.0.0.X
  /usr/local/lib/libtspi.so -> libtspi.so.0.0.X
  /usr/local/lib/libtspi.la
  /usr/local/lib/libtddl.a
  /usr/local/var/lib/tpm

  By default the build will place everything in /usr/local. To install
in a slightly more predictable place, use `./configure --prefix=/usr`.

  'make install' will run ldconfig, but if /usr/local/lib is not in
your /etc/ld.so.conf, this won't make a difference. You may need to
manually add it and run ldconfig as root to allow your apps to link at
run time to libtspi.so.


ARCHITECTURE

  This TSS implementation has several components.

  A) The TCS Daemon - A user space daemon that should be (according to
     the TSS spec) the only portal to the TPM device driver. At boot
     time, the TCS Daemon should be started, it should open the TPM
     device driver and from that point on, all requests to the TPM
     should go through the TSS stack. The TCSD manages TPM resources
     and handles requests from TSP's both local and remote.

  B) The TSP shared library - The TSP (TCG Service Provider) is a
     shared library that enables applications to talk to TCSD's both
     locally and remotely. The TSP also manages resources used in
     commicating with the application and the TCSD and transparently
     contacts the TCSD whenever necessary

  C) Persistent storage files - TSS's have 2 different kinds of
     'persistent' storage. 'User' persistent storage has the lifetime
     of that of the application using it (not very persistent, IMO)
     and therefore is destroyed when an application exits.  User PS is
     controlled by the TSP of the application.  'System' persistent
     storage is controlled by the TCS and stays valid across
     application lifetimes, TCSD restarts and system resets. Data
     registered in system PS stays valid until an application requests
     that it be removed. User PS files are by default stored as
     /var/lib/tpm/user.{pid} and the system PS file by default is
     /var/lib/tpm/system.data. The system PS file is initially created
     when ownership of the TPM is first taken.

  D) A config file. By default located in $prefix/etc/tcsd.conf.


RUNNING the TSS

  By default, the TCS daemon is not reachable over the internet, so if
you just plan to access it locally, running it as root with a root owned
device node is probably ok.  Just make sure your device driver is loaded
and start the tcsd as root.

  If you would like to run the TCS daemon as an unprivleged user,
please follow these instructions:

  If you're using the device driver from a linux 2.6.12+ kernel and have
udev enabled, you need to add the following line to your
udev.permissions file (usually in /etc/udev somewhere):

  tpm[0-9]:tss:tss:0600

  and then just load the device driver with:
  # modprobe tpm_atmel
  or,
  # modprobe tpm_natl

  start the TCS Core Services daemon, by default /usr/local/sbin/tcsd.
  # startproc -u tss /usr/local/sbin/tcsd


BUILDING a TSS RPM

 # sh bootstrap.sh
 # ./configure --prefix=/usr
 # cd ..
 # mv trousers trousers-${version}
 # tar zcvf /usr/src/packages/SOURCES/trousers-${version}.tar.gz \
            trousers-${version}
 # rpmbuild -bb trousers-${version}/dist/trousers.spec

EOF
